<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pymetrics - Tower Game</title>
    <style>
        @import url('https://fonts.googleapis.comcom/css2?family=Poppins:wght@400;600;700&display=swap');

        :root {
            --bg-color: #27ae60;
            --container-bg: #ffffff;
            --primary-text: #2c3e50;
            --secondary-text: #7f8c8d;
            --tower-color: #bdc3c7;
            --accent-color: #e67e22;
            --shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--primary-text);
        }

        .game-container {
            width: 90%;
            max-width: 800px;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            position: relative;
            min-height: 600px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Screens --- */
        .screen { display: none; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; flex-grow: 1; }
        .screen.visible { display: flex; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* Instructions Screen */
        #instructions-screen h1 { text-align: center; margin-bottom: 20px; }
        #instructions-screen ul { text-align: left; list-style-type: '✔️ '; padding-left: 20px; font-size: 1.1em; line-height: 2; }

        /* Game Screen */
        .game-header { position: absolute; top: 20px; left: 30px; display: flex; gap: 20px; font-size: 1.2em; font-weight: 600; }
        #target-container, #play-container { width: 100%; display: flex; justify-content: space-around; align-items: flex-end; }
        #target-container { height: 120px; border-bottom: 2px solid #ecf0f1; margin-bottom: 20px; padding-bottom: 10px; }
        #play-container { flex-grow: 1; }

        .tower { width: 30%; height: 100%; display: flex; flex-direction: column-reverse; align-items: center; border-bottom: 10px solid var(--tower-color); position: relative; }
        .tower::after { content: ''; position: absolute; bottom: 0; width: 10px; height: 100%; background: var(--tower-color); }
        .target .tower { height: 100%; border-bottom-width: 5px; }
        .target .tower::after { width: 5px; }

        .disk { border-radius: 10px; margin-bottom: 4px; transition: opacity 0.2s; }
        .disk.dragging { opacity: 0.5; }
        
        .play .disk { height: 30px; }
        .target .disk { height: 15px; }
        
        /* Disk Sizes & Colors */
        .disk[data-size='5'] { width: 95%; background-color: #e74c3c; } /* Red */
        .disk[data-size='4'] { width: 80%; background-color: #f8a5c2; } /* Pink */
        .disk[data-size='3'] { width: 65%; background-color: #2ecc71; } /* Green */
        .disk[data-size='2'] { width: 50%; background-color: #f1c40f; } /* Yellow */
        .disk[data-size='1'] { width: 35%; background-color: #3498db; } /* Blue */
        
        .controls { display: flex; justify-content: center; gap: 20px; padding-top: 20px; }
        .control-btn { padding: 12px 30px; font-size: 1.1em; font-weight: 600; border-radius: 8px; border: none; cursor: pointer; color: white; }
        #clear-btn { background-color: var(--accent-color); }
        #undo-btn { background-color: var(--bg-color); }

        /* Results Screen */
        #end-game-screen { align-items: flex-start; text-align: left; }
        #end-game-screen h2 { width: 100%; text-align: center; font-size: 1.8em; margin-bottom: 30px; }
        .results-summary p { font-size: 1.1em; margin: 12px 0; color: var(--secondary-text); }
        .results-summary strong { color: var(--primary-text); }
        .button-container { display: flex; justify-content: space-between; width: 100%; margin-top: auto; }
        
        /* General Button */
        .primary-btn { padding: 15px 50px; font-size: 1.2em; font-weight: 600; border: none; border-radius: 10px; cursor: pointer; transition: all 0.2s ease; background-color: var(--bg-color); color: var(--container-bg); margin-top: 20px; }
        .end-button { padding: 12px 30px; font-size: 1.1em; font-weight: 600; border-radius: 8px; border: none; cursor: pointer; background: #BDC3C7; color: #fff; }
    </style>
</head>
<body>

    <div class="game-container">
        
        <div id="instructions-screen" class="screen visible">
            <h1>Instructions</h1>
            <ul>
                <li>Your goal is to make the bottom towers match the target towers.</li>
                <li>You can only move the top disk on a tower.</li>
                <li>Drag a disk onto a new tower to move it.</li>
                <li>You have <strong>2 minutes</strong> to solve the puzzle.</li>
            </ul>
            <button id="start-btn" class="primary-btn">Begin</button>
        </div>

        <div id="game-screen" class="screen">
            <div class="game-header">
                <div id="game-timer">Time: 2:00</div>
                <div id="move-counter">Moves: 0</div>
            </div>
            <div id="target-container" class="target"></div>
            <div id="play-container" class="play"></div>
            <div class="controls">
                <button id="clear-btn" class="control-btn">Clear All</button>
                <button id="undo-btn" class="control-btn">Undo</button>
            </div>
        </div>

        <div id="end-game-screen" class="screen">
            <h2>Game Complete</h2>
            <div class="results-summary">
                <p>You have completed this game.</p>
                <p><strong>Number of moves made:</strong> <span id="final-moves"></span></p>
                <p><strong>Time Taken:</strong> <span id="final-time"></span></p>
                <p>Click the next button to move on to the next game.</p>
            </div>
            <div class="button-container">
                <button class="end-button" id="next-btn">Next</button>
                <button class="end-button" id="menu-btn">Back To Menu</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const screens = { instructions: document.getElementById('instructions-screen'), game: document.getElementById('game-screen'), endGame: document.getElementById('end-game-screen') };
            const startBtn = document.getElementById('start-btn');
            const targetContainer = document.getElementById('target-container');
            const playContainer = document.getElementById('play-container');
            const gameTimerDisplay = document.getElementById('game-timer');
            const moveCounterDisplay = document.getElementById('move-counter');
            const clearBtn = document.getElementById('clear-btn');
            const undoBtn = document.getElementById('undo-btn');
            const finalMoves = document.getElementById('final-moves');
            const finalTime = document.getElementById('final-time');
            const nextBtn = document.getElementById('next-btn');
            const menuBtn = document.getElementById('menu-btn');
            
            // --- Game Config ---
            const GAME_DURATION = 120; // 2 minutes
            const INITIAL_STATE = [[5, 4, 3], [], [2, 1]]; // Disk sizes. Larger number is larger disk.
            const TARGET_STATE = [[], [3, 2], [5, 4, 1]];

            // --- Game State ---
            let gameState = 'instructions';
            let towersState, moveCount, gameTimer, startTime, timeTaken;
            let moveHistory = [];
            let draggedDisk = null;

            function showScreen(screenName) {
                Object.values(screens).forEach(screen => screen.classList.remove('visible'));
                screens[screenName].classList.add('visible');
            }

            function initGame() {
                towersState = JSON.parse(JSON.stringify(INITIAL_STATE));
                moveCount = 0;
                moveHistory = [];
                timeTaken = 0;
                clearInterval(gameTimer);
                renderAllTowers();
                showScreen('instructions');
            }

            function startGame() {
                initGame(); // Reset state
                gameState = 'playing';
                startTime = Date.now();
                
                gameTimer = setInterval(() => {
                    const elapsed = Math.floor((Date.now() - startTime) / 1000);
                    const timeLeft = GAME_DURATION - elapsed;
                    if (timeLeft <= 0) {
                        endGame(false); // Time's up
                    }
                    const minutes = Math.floor(timeLeft / 60);
                    const seconds = timeLeft % 60;
                    gameTimerDisplay.textContent = `Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);

                updateMoveCounter();
                showScreen('game');
            }

            function renderAllTowers() {
                renderTowers(targetContainer, TARGET_STATE, 'target');
                renderTowers(playContainer, towersState, 'play');
            }

            function renderTowers(container, state, type) {
                container.innerHTML = '';
                state.forEach((towerData, towerIndex) => {
                    const towerEl = document.createElement('div');
                    towerEl.className = 'tower';
                    towerEl.dataset.towerId = towerIndex;

                    towerData.forEach(diskSize => {
                        const diskEl = document.createElement('div');
                        diskEl.className = 'disk';
                        diskEl.dataset.size = diskSize;
                        towerEl.appendChild(diskEl);
                    });
                    
                    if (type === 'play') {
                        // Make top disk draggable
                        if (towerEl.lastChild) {
                            towerEl.lastChild.draggable = true;
                        }
                        // Add drag and drop listeners
                        towerEl.addEventListener('dragstart', handleDragStart);
                        towerEl.addEventListener('dragover', handleDragOver);
                        towerEl.addEventListener('drop', handleDrop);
                    }
                    container.appendChild(towerEl);
                });
            }

            function handleDragStart(e) {
                if (!e.target.classList.contains('disk')) return;
                draggedDisk = {
                    size: parseInt(e.target.dataset.size),
                    sourceTower: parseInt(e.target.parentElement.dataset.towerId)
                };
                e.target.classList.add('dragging');
            }
            
            function handleDragOver(e) { e.preventDefault(); }

            function handleDrop(e) {
                e.preventDefault();
                const destinationTowerEl = e.target.classList.contains('tower') ? e.target : e.target.parentElement;
                const destinationTowerId = parseInt(destinationTowerEl.dataset.towerId);
                
                if (draggedDisk.sourceTower === destinationTowerId) return; // Dropped on same tower

                const destinationTower = towersState[destinationTowerId];
                const topDiskSize = destinationTower.length > 0 ? destinationTower[destinationTower.length - 1] : Infinity;

                if (draggedDisk.size < topDiskSize) { // Valid move
                    moveHistory.push(JSON.parse(JSON.stringify(towersState)));
                    
                    towersState[draggedDisk.sourceTower].pop();
                    towersState[destinationTowerId].push(draggedDisk.size);
                    
                    moveCount++;
                    updateMoveCounter();
                    renderTowers(playContainer, towersState, 'play');
                    
                    if (checkWin()) {
                        endGame(true); // Win
                    }
                }
                draggedDisk = null;
                document.querySelector('.dragging')?.classList.remove('dragging');
            }
            
            function handleUndo() {
                if (moveHistory.length > 0) {
                    towersState = moveHistory.pop();
                    moveCount--;
                    updateMoveCounter();
                    renderTowers(playContainer, towersState, 'play');
                }
            }

            function updateMoveCounter() {
                moveCounterDisplay.textContent = `Moves: ${moveCount}`;
            }

            function checkWin() {
                return JSON.stringify(towersState) === JSON.stringify(TARGET_STATE);
            }

            function endGame(isWin) {
                clearInterval(gameTimer);
                gameState = 'finished';
                const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsedSeconds / 60);
                const seconds = elapsedSeconds % 60;

                finalMoves.textContent = moveCount;
                finalTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                showScreen('endGame');
            }

            // --- Event Listeners ---
            startBtn.addEventListener('click', startGame);
            clearBtn.addEventListener('click', () => {
                towersState = JSON.parse(JSON.stringify(INITIAL_STATE));
                moveCount = 0;
                moveHistory = [];
                updateMoveCounter();
                renderTowers(playContainer, towersState, 'play');
            });
            undoBtn.addEventListener('click', handleUndo);
            nextBtn.addEventListener('click', initGame);
            menuBtn.addEventListener('click', initGame);
            
            initGame();
        });
    </script>
</body>
</html>